{% extends "base.html" %}

{% block title %}BankingAI CTF{% endblock %}

{% block head_extra %}
<style>
  .tab-bar {
    display: flex;
    border-bottom: 1px solid var(--bdr);
    margin: -2rem -2rem 1.75rem;
  }
  .tab-btn {
    flex: 1; margin: 0; border-radius: 0; border: none;
    border-bottom: 2px solid transparent;
    background: transparent; font-family: var(--sans); font-weight: 700;
    font-size: .75rem; letter-spacing: .1em; text-transform: uppercase;
    color: var(--muted); padding: .8rem; cursor: pointer;
    transition: color .15s, border-color .15s; box-shadow: none;
  }
  .tab-btn:hover { background: rgba(0,200,255,.04); box-shadow: none; }
  .tab-btn.active { color: var(--head); border-bottom-color: var(--cyan); background: transparent; }
  .form-hint { font-size: .82rem; color: var(--muted); margin-bottom: 1.25rem; line-height: 1.5; }
</style>
{% endblock %}

{% block content %}
<div style="text-align:center; margin-bottom:1.75rem;">
  <img src="{{ url_for('static', filename='swocts_logo.png') }}" alt="SWOCTS"
       style="height:72px;width:auto;margin-bottom:.85rem;display:block;margin-left:auto;margin-right:auto;">
  <div style="font-family:var(--disp);font-size:1.1rem;letter-spacing:.2em;color:var(--muted);text-transform:uppercase;">SWOCTS Cybersecurity</div>
</div>
<div class="card" style="min-width:320px;">

  <div class="tab-bar">
    <button type="button" class="tab-btn active" id="tab-register" onclick="switchTab('register')">Register</button>
    <button type="button" class="tab-btn" id="tab-login" onclick="switchTab('login')">Log In</button>
  </div>

  <!-- Register panel -->
  <div id="panel-register">
    <p class="form-hint">Create a team to receive your isolated CTF instance.</p>
    <form method="POST" action="/register">
      <label for="reg-name">Team name</label>
      <input id="reg-name" type="text" name="name"
             placeholder="lowercase Â· no spaces" maxlength="32"
             pattern="[a-z0-9_-]+"
             title="Lowercase letters, numbers, underscores, hyphens only"
             required>
      <label for="reg-pass">Password</label>
      <input id="reg-pass" type="password" name="password"
             placeholder="min 8 characters" minlength="8" required>
      <label for="reg-pass2">Confirm password</label>
      <input id="reg-pass2" type="password" name="password2"
             placeholder="repeat password" required>
      <button type="submit">Register &amp; Launch Instance</button>
    </form>
  </div>

  <!-- Login panel -->
  <div id="panel-login" style="display:none;">
    <p class="form-hint">Already registered? Log in to view your instance.</p>
    <form method="POST" action="/login">
      <label for="login-name">Team name</label>
      <input id="login-name" type="text" name="name" placeholder="your team name" required>
      <label for="login-pass">Password</label>
      <input id="login-pass" type="password" name="password" placeholder="your password" required>
      <button type="submit">Log In</button>
    </form>
  </div>

  <p style="text-align:center; margin-top:1.5rem; font-size:.78rem; color:var(--muted);">
    Admin? <a href="/admin">Admin panel &rarr;</a>
  </p>
</div>

<script>
  function switchTab(tab) {
    var isReg = tab === 'register';
    document.getElementById('panel-register').style.display = isReg ? '' : 'none';
    document.getElementById('panel-login').style.display    = isReg ? 'none' : '';
    document.getElementById('tab-register').classList.toggle('active', isReg);
    document.getElementById('tab-login').classList.toggle('active', !isReg);
  }

  {% for category, message in get_flashed_messages(with_categories=true) %}
    {% if 'password' in message.lower() or 'team name' in message.lower() %}
      switchTab('{{ "login" if "Invalid" in message else "register" }}');
    {% endif %}
  {% endfor %}
</script>
{% endblock %}
